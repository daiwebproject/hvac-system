{{ define "content" }}
<div class="container mx-auto p-6 max-w-5xl">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold text-gray-800">Quản lý Khung Giờ</h1>
            <p class="text-gray-500">Thiết lập và theo dõi lịch làm việc của đội thợ</p>
        </div>
        <a href="/admin" class="btn btn-ghost">
            <i class="fa-solid fa-arrow-left"></i> Quay lại Dashboard
        </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6" x-data="slotManager()" x-init="init()">

        <div class="lg:col-span-1">
            <div class="card bg-base-100 shadow-xl border border-base-200 sticky top-6">
                <div class="card-body">
                    <h2 class="card-title text-xl text-primary">
                        <i class="fa-solid fa-wand-magic-sparkles"></i>
                        Tạo Lịch Tự Động
                    </h2>
                    <p class="text-sm text-gray-500 mb-4">Tạo nhanh khung giờ cho 7 ngày tới (6 ca/ngày).</p>

                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text font-semibold">Số thợ tối đa (Capacity)</span>
                        </label>
                        <div class="join w-full">
                            <button @click="techCount > 1 ? techCount-- : null"
                                class="btn btn-square join-item">-</button>
                            <input type="number" x-model="techCount"
                                class="input input-bordered w-full text-center join-item font-bold" min="1" max="20">
                            <button @click="techCount++" class="btn btn-square join-item">+</button>
                        </div>
                        <label class="label">
                            <span class="label-text-alt text-gray-500">Số lượng đơn tối đa mỗi khung giờ</span>
                        </label>
                    </div>

                    <div class="card-actions justify-end mt-4">
                        <button @click="generateWeek()" :disabled="loading" class="btn btn-primary w-full shadow-lg">
                            <span x-show="!loading"><i class="fa-solid fa-calendar-plus"></i> TẠO LỊCH 7 NGÀY</span>
                            <span x-show="loading" class="loading loading-spinner"></span>
                        </button>
                    </div>

                    <div x-show="message" x-transition class="alert mt-4 text-sm py-2"
                        :class="success ? 'alert-success' : 'alert-error'">
                        <span x-text="message"></span>
                    </div>

                    <div class="divider"></div>

                    <div class="text-xs text-gray-500">
                        <p class="font-bold mb-1"><i class="fa-solid fa-circle-info"></i> Quy tắc hệ thống:</p>
                        <ul class="list-disc pl-4 space-y-1">
                            <li>Ca 1: 08:00 - 10:00</li>
                            <li>Ca 2: 10:00 - 12:00</li>
                            <li>Ca 3: 13:00 - 15:00</li>
                            <li>Ca 4: 15:00 - 17:00</li>
                            <li>Ca 5: 17:00 - 19:00</li>
                            <li>Ca 6: 19:00 - 21:00</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="lg:col-span-2">
            <div class="card bg-base-100 shadow-xl border border-base-200">
                <div class="card-body p-0">
                    <div class="p-4 border-b border-base-200 flex justify-between items-center bg-gray-50 rounded-t-xl">
                        <h2 class="font-bold text-lg"><i class="fa-regular fa-calendar-check mr-2"></i> Lịch Đang Mở
                            (Sắp tới)</h2>
                        <button @click="fetchSlots()" class="btn btn-ghost btn-sm btn-circle tooltip"
                            data-tip="Làm mới">
                            <i class="fa-solid fa-rotate" :class="loadingList ? 'fa-spin' : ''"></i>
                        </button>
                    </div>

                    <div class="overflow-x-auto max-h-[600px]">
                        <table class="table table-zebra table-pin-rows">
                            <thead>
                                <tr>
                                    <th>Ngày</th>
                                    <th>Giờ</th>
                                    <th>Tình trạng (Đã đặt / Tổng)</th>
                                    <th>Trạng thái</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-if="loadingList">
                                    <tr>
                                        <td colspan="4" class="text-center py-8"><span
                                                class="loading loading-dots loading-lg text-primary"></span></td>
                                    </tr>
                                </template>

                                <template x-if="!loadingList && slots.length === 0">
                                    <tr>
                                        <td colspan="4" class="text-center py-10 text-gray-400">
                                            <i class="fa-regular fa-calendar-xmark text-4xl mb-2"></i>
                                            <p>Chưa có lịch nào được tạo cho 7 ngày tới.</p>
                                            <p class="text-sm">Hãy dùng công cụ bên trái để tạo lịch.</p>
                                        </td>
                                    </tr>
                                </template>

                                <template x-for="slot in slots" :key="slot.id">
                                    <tr class="hover">
                                        <td>
                                            <div class="font-bold" x-text="formatDate(slot.date)"></div>
                                            <div class="text-xs text-gray-500" x-text="getDayName(slot.date)"></div>
                                        </td>
                                        <td>
                                            <div class="badge badge-neutral font-mono"
                                                x-text="slot.start_time.substring(0,5) + ' - ' + slot.end_time.substring(0,5)">
                                            </div>
                                        </td>
                                        <td>
                                            <div class="flex items-center gap-2">
                                                <progress class="progress w-20"
                                                    :class="getProgressColor(slot.current_bookings, slot.max_capacity)"
                                                    :value="slot.current_bookings" :max="slot.max_capacity"></progress>
                                                <span class="text-xs font-bold"
                                                    x-text="slot.current_bookings + '/' + slot.max_capacity"></span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge badge-sm"
                                                :class="slot.is_active ? 'badge-success badge-outline' : 'badge-ghost'">
                                                <span x-text="slot.is_active ? 'Đang mở' : 'Đã khóa'"></span>
                                            </span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{{ end }}