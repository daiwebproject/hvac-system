{{ define "content" }}
<div class="container mx-auto p-6 max-w-5xl">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold text-gray-800">Qu·∫£n l√Ω Khung Gi·ªù</h1>
            <p class="text-gray-500">H·ªá th·ªëng l·∫≠p l·ªãch th√¥ng minh - T·ª± ƒë·ªông ƒë·ªìng b·ªô v·ªõi s·ªë th·ª£ ƒëang tr·ª±c</p>
        </div>
        <a href="/admin" class="btn btn-ghost">
            <i class="fa-solid fa-arrow-left"></i> Quay l·∫°i Dashboard
        </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6" x-data="slotManager()" x-init="init()">

        <div class="lg:col-span-1 space-y-4">

            <!-- Smart Scheduling Info Card -->
            <div class="card bg-gradient-to-br from-blue-500 to-cyan-500 text-white shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-xl">
                        <i class="fa-solid fa-brain"></i>
                        L·ªãch Th√¥ng Minh
                    </h2>
                    <p class="text-blue-100 text-sm">
                        Khung gi·ªù ƒë∆∞·ª£c <strong>t·ª± ƒë·ªông t·∫°o</strong> khi kh√°ch ƒë·∫∑t l·ªãch, d·ª±a tr√™n s·ªë th·ª£ ƒëang tr·ª±c.
                    </p>

                    <div class="divider divider-neutral my-2 opacity-30"></div>

                    <div class="stats stats-vertical bg-white/10 backdrop-blur rounded-xl">
                        <div class="stat py-2">
                            <div class="stat-title text-blue-100 text-xs">Th·ª£ ƒëang tr·ª±c (Active)</div>
                            <div class="stat-value text-3xl">{{ .ActiveTechCount }}</div>
                            <div class="stat-desc text-blue-200">= Capacity m·ªói ca</div>
                        </div>
                    </div>

                    <div class="text-xs text-blue-100 mt-2 bg-white/10 p-3 rounded-lg">
                        <i class="fa-solid fa-circle-info mr-1"></i>
                        M·ªói khung gi·ªù s·∫Ω nh·∫≠n t·ªëi ƒëa <strong>{{ .ActiveTechCount }} ƒë∆°n</strong> (1 ƒë∆°n/th·ª£).
                        Khi th√™m ho·∫∑c t·∫Øt th·ª£, capacity t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh.
                    </div>
                </div>
            </div>

            <!-- Active Technicians List -->
            <div class="card bg-base-100 shadow-xl border border-base-200">
                <div class="card-body">
                    <h2 class="card-title text-lg">
                        <i class="fa-solid fa-users-gear text-green-500"></i>
                        Th·ª£ ƒêang Tr·ª±c
                    </h2>

                    {{ if .ActiveTechs }}
                    <div class="space-y-2 mt-2">
                        {{ range .ActiveTechs }}
                        <div class="flex items-center gap-3 p-2 bg-gray-50 rounded-lg">
                            <div class="avatar placeholder">
                                <div class="bg-green-500 text-white rounded-full w-8">
                                    <span class="text-xs">{{ slice .name 0 1 }}</span>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="font-semibold text-sm">{{ .name }}</div>
                                <div class="text-xs text-gray-500">{{ .phone }}</div>
                            </div>
                            <span class="badge badge-success badge-sm">Online</span>
                        </div>
                        {{ end }}
                    </div>
                    {{ else }}
                    <div class="text-center py-4 text-gray-400">
                        <i class="fa-solid fa-user-slash text-2xl mb-2"></i>
                        <p>Ch∆∞a c√≥ th·ª£ n√†o ƒëang tr·ª±c</p>
                        <p class="text-xs">Kh√°ch s·∫Ω kh√¥ng th·ªÉ ƒë·∫∑t l·ªãch</p>
                    </div>
                    {{ end }}

                    <a href="/admin/techs" class="btn btn-ghost btn-sm mt-2">
                        <i class="fa-solid fa-arrow-right"></i> Qu·∫£n l√Ω Th·ª£
                    </a>
                </div>
            </div>

            <!-- Optional: Pre-generate for week -->
            <div class="card bg-base-100 shadow border border-base-200">
                <div class="card-body">
                    <h2 class="card-title text-sm text-gray-600">
                        <i class="fa-solid fa-calendar-plus"></i>
                        T·∫°o tr∆∞·ªõc (T√πy ch·ªçn)
                    </h2>
                    <p class="text-xs text-gray-500">
                        T·∫°o s·∫µn khung gi·ªù cho 7 ng√†y t·ªõi. H·ªá th·ªëng s·∫Ω d√πng s·ªë th·ª£ hi·ªán t·∫°i (<strong>{{ .ActiveTechCount
                            }}</strong>) l√†m capacity.
                    </p>
                    <div class="card-actions mt-3">
                        <button @click="generateWeek()" :disabled="loading" class="btn btn-outline btn-sm w-full">
                            <span x-show="!loading"><i class="fa-solid fa-wand-magic-sparkles"></i> T·∫°o L·ªãch 7
                                Ng√†y</span>
                            <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                        </button>
                    </div>
                    <div x-show="message" x-transition class="alert mt-2 text-xs py-2"
                        :class="success ? 'alert-success' : 'alert-error'">
                        <span x-text="message"></span>
                    </div>
                </div>
            </div>

            <!-- System Rules -->
            <div class="text-xs text-gray-500 bg-gray-50 p-4 rounded-xl">
                <p class="font-bold mb-2"><i class="fa-solid fa-clock"></i> Khung gi·ªù m·∫∑c ƒë·ªãnh:</p>
                <ul class="list-none space-y-1">
                    <li>üåÖ Ca 1: 08:00 - 10:00</li>
                    <li>‚òÄÔ∏è Ca 2: 10:00 - 12:00</li>
                    <li>üå§Ô∏è Ca 3: 13:00 - 15:00</li>
                    <li>üåá Ca 4: 15:00 - 17:00</li>
                    <li>üåÜ Ca 5: 17:00 - 19:00</li>
                    <li>üåô Ca 6: 19:00 - 21:00</li>
                </ul>
            </div>
        </div>

        <div class="lg:col-span-2">
            <div class="card bg-base-100 shadow-xl border border-base-200">
                <div class="card-body p-0">
                    <div class="p-4 border-b border-base-200 flex justify-between items-center bg-gray-50 rounded-t-xl">
                        <h2 class="font-bold text-lg"><i class="fa-regular fa-calendar-check mr-2"></i> L·ªãch ƒêang M·ªü
                            (7 Ng√†y T·ªõi)</h2>
                        <button @click="fetchSlots()" class="btn btn-ghost btn-sm btn-circle tooltip"
                            data-tip="L√†m m·ªõi">
                            <i class="fa-solid fa-rotate" :class="loadingList ? 'fa-spin' : ''"></i>
                        </button>
                    </div>

                    <div class="overflow-x-auto max-h-[600px]">
                        <table class="table table-zebra table-pin-rows">
                            <thead>
                                <tr>
                                    <th>Ng√†y</th>
                                    <th>Gi·ªù</th>
                                    <th>T√¨nh tr·∫°ng (ƒê√£ ƒë·∫∑t / Capacity)</th>
                                    <th>Tr·∫°ng th√°i</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-if="loadingList">
                                    <tr>
                                        <td colspan="4" class="text-center py-8"><span
                                                class="loading loading-dots loading-lg text-primary"></span></td>
                                    </tr>
                                </template>

                                <template x-if="!loadingList && slots.length === 0">
                                    <tr>
                                        <td colspan="4" class="text-center py-10 text-gray-400">
                                            <i class="fa-solid fa-robot text-4xl mb-3 text-blue-300"></i>
                                            <p class="font-bold text-gray-600">Ch·∫ø ƒë·ªô t·ª± ƒë·ªông ƒëang b·∫≠t</p>
                                            <p class="text-sm mt-1">Khung gi·ªù s·∫Ω ƒë∆∞·ª£c t·∫°o khi kh√°ch ch·ªçn ng√†y ƒë·∫∑t l·ªãch.
                                            </p>
                                            <p class="text-xs mt-2 text-gray-400">Ho·∫∑c b·∫•m "T·∫°o L·ªãch 7 Ng√†y" b√™n tr√°i ƒë·ªÉ
                                                t·∫°o tr∆∞·ªõc.</p>
                                        </td>
                                    </tr>
                                </template>

                                <template x-for="slot in slots" :key="slot.id">
                                    <tr class="hover">
                                        <td>
                                            <div class="font-bold" x-text="formatDate(slot.date)"></div>
                                            <div class="text-xs text-gray-500" x-text="getDayName(slot.date)"></div>
                                        </td>
                                        <td>
                                            <div class="badge badge-neutral font-mono"
                                                x-text="slot.start_time.substring(0,5) + ' - ' + slot.end_time.substring(0,5)">
                                            </div>
                                        </td>
                                        <td>
                                            <div class="flex items-center gap-2">
                                                <progress class="progress w-20"
                                                    :class="getProgressColor(slot.current_bookings, slot.max_capacity)"
                                                    :value="slot.current_bookings" :max="slot.max_capacity"></progress>
                                                <span class="text-xs font-bold"
                                                    x-text="slot.current_bookings + '/' + slot.max_capacity"></span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge badge-sm"
                                                :class="slot.is_active ? 'badge-success badge-outline' : 'badge-ghost'">
                                                <span x-text="slot.is_active ? 'C√≤n ch·ªó' : 'ƒê√£ ƒë·∫ßy'"></span>
                                            </span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{{ end }}