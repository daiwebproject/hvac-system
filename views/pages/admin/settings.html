{{ define "content" }}
<div class="p-4 md:p-6 max-w-7xl mx-auto" x-data="{ activeTab: 'general' }">

    <div class="flex justify-between items-center mb-6 md:mb-8">
        <h1 class="text-xl md:text-2xl font-bold text-gray-800">
            <i class="fa-solid fa-sliders text-blue-600 mr-2"></i>Cài Đặt Hệ Thống
        </h1>
    </div>

    <form hx-post="/admin/settings" hx-encoding="multipart/form-data" hx-swap="none"
        class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">

        <div class="flex border-b bg-gray-50/50 overflow-x-auto whitespace-nowrap no-scrollbar">
            <button type="button" @click="activeTab = 'general'"
                class="px-4 py-3 md:px-6 md:py-4 font-medium text-sm transition-colors relative flex-shrink-0"
                :class="activeTab === 'general' ? 'text-blue-600 bg-white border-t-2 border-t-blue-600' : 'text-gray-500 hover:text-gray-700'">
                <i class="fa-solid fa-building mr-2"></i>Thông tin chung
            </button>
            <button type="button" @click="activeTab = 'seo'"
                class="px-4 py-3 md:px-6 md:py-4 font-medium text-sm transition-colors relative flex-shrink-0"
                :class="activeTab === 'seo' ? 'text-purple-600 bg-white border-t-2 border-t-purple-600' : 'text-gray-500 hover:text-gray-700'">
                <i class="fa-solid fa-magnifying-glass mr-2"></i>Cấu hình SEO
            </button>
            <button type="button" @click="activeTab = 'interface'"
                class="px-4 py-3 md:px-6 md:py-4 font-medium text-sm transition-colors relative flex-shrink-0"
                :class="activeTab === 'interface' ? 'text-orange-600 bg-white border-t-2 border-t-orange-600' : 'text-gray-500 hover:text-gray-700'">
                <i class="fa-solid fa-image mr-2"></i>Giao diện
            </button>
            <button type="button" @click="activeTab = 'payment'"
                class="px-4 py-3 md:px-6 md:py-4 font-medium text-sm transition-colors relative flex-shrink-0"
                :class="activeTab === 'payment' ? 'text-green-600 bg-white border-t-2 border-t-green-600' : 'text-gray-500 hover:text-gray-700'">
                <i class="fa-solid fa-credit-card mr-2"></i>Thanh toán
            </button>
            <button type="button" @click="activeTab = 'license'"
                class="px-4 py-3 md:px-6 md:py-4 font-medium text-sm transition-colors relative flex-shrink-0"
                :class="activeTab === 'license' ? 'text-red-600 bg-white border-t-2 border-t-red-600' : 'text-gray-500 hover:text-gray-700'">
                <i class="fa-solid fa-shield-halved mr-2"></i>Giấy phép
            </button>
            <button type="button" @click="activeTab = 'notifications'"
                class="px-4 py-3 md:px-6 md:py-4 font-medium text-sm transition-colors relative flex-shrink-0"
                :class="activeTab === 'notifications' ? 'text-teal-600 bg-white border-t-2 border-t-teal-600' : 'text-gray-500 hover:text-gray-700'">
                <i class="fa-solid fa-bell mr-2"></i>Thông báo
            </button>
        </div>

        <div class="p-4 md:p-8">
            <div x-show="activeTab === 'general'" class="space-y-6 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label font-bold text-gray-700">Tên Công Ty / Thương Hiệu</label>
                        <input type="text" name="company_name" value="{{.Settings.CompanyName}}"
                            class="input input-bordered w-full focus:input-primary" placeholder="VD: Đại Điện Lạnh">
                    </div>
                    <div class="form-control">
                        <label class="label font-bold text-gray-700">Hotline</label>
                        <input type="text" name="hotline" value="{{.Settings.Hotline}}"
                            class="input input-bordered w-full focus:input-primary">
                    </div>
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Logo (Vuông/Tròn)</label>
                    <div class="flex items-center gap-4">
                        {{ if .Settings.Logo }}
                        <div class="avatar">
                            <div class="w-16 rounded-xl ring ring-primary ring-offset-base-100 ring-offset-2">
                                <img src="/api/files/settings/{{.Settings.Id}}/{{.Settings.Logo}}" />
                            </div>
                        </div>
                        {{ end }}
                        <input type="file" name="logo" class="file-input file-input-bordered w-full max-w-xs"
                            accept="image/*">
                    </div>
                </div>
            </div>

            <div x-show="activeTab === 'seo'" class="space-y-6 animate-fade-in" style="display: none;">
                <div class="alert bg-purple-50 border-purple-100 text-purple-900 text-sm">
                    <i class="fa-solid fa-info-circle"></i> Cấu hình này giúp website hiển thị tốt hơn trên Google và
                    khi chia sẻ lên Facebook/Zalo.
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Tiêu đề trang (SEO Title)</label>
                    <input type="text" name="seo_title" value="{{.Settings.SeoTitle}}"
                        class="input input-bordered w-full" placeholder="VD: Sửa chữa điện lạnh uy tín tại Nam Định">
                    <label class="label"><span class="label-text-alt text-gray-400">Nên chứa từ khóa chính, dưới 60 ký
                            tự.</span></label>
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Mô tả tìm kiếm (Meta Description)</label>
                    <textarea name="seo_description" class="textarea textarea-bordered h-24"
                        placeholder="Mô tả ngắn gọn dịch vụ...">{{.Settings.SeoDescription}}</textarea>
                    <label class="label"><span class="label-text-alt text-gray-400">Hiển thị dưới tiêu đề trên Google.
                            Dưới 160 ký tự.</span></label>
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Từ khóa (Keywords)</label>
                    <input type="text" name="seo_keywords" value="{{.Settings.SeoKeywords}}"
                        class="input input-bordered w-full" placeholder="sua dieu hoa, bao duong may giat...">
                </div>
            </div>

            <div x-show="activeTab === 'interface'" class="space-y-6 animate-fade-in" style="display: none;">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <div class="form-control">
                            <label class="label font-bold text-gray-700">Tiêu đề lớn (Hero Title)</label>
                            <input type="text" name="hero_title" value="{{.Settings.HeroTitle}}"
                                class="input input-bordered font-bold text-lg" placeholder="GIẢI PHÁP ĐIỆN LẠNH">
                        </div>
                        <div class="form-control">
                            <label class="label font-bold text-gray-700">Tiêu đề phụ (Subtitle)</label>
                            <input type="text" name="hero_subtitle" value="{{.Settings.HeroSubtitle}}"
                                class="input input-bordered text-blue-600" placeholder="CHUYÊN NGHIỆP & TẬN TÂM">
                        </div>
                        <div class="form-control">
                            <label class="label font-bold text-gray-700">Lời chào (Welcome Text)</label>
                            <textarea name="welcome_text" class="textarea textarea-bordered h-24"
                                placeholder="Đội ngũ kỹ thuật viên tay nghề cao...">{{.Settings.WelcomeText}}</textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-control">
                                <label class="label font-bold text-gray-700">Chữ nút bấm</label>
                                <input type="text" name="hero_cta_text" value="{{.Settings.HeroCtaText}}"
                                    class="input input-bordered" placeholder="ĐẶT LỊCH NGAY">
                            </div>
                            <div class="form-control">
                                <label class="label font-bold text-gray-700">Link nút bấm</label>
                                <input type="text" name="hero_cta_link" value="{{.Settings.HeroCtaLink}}"
                                    class="input input-bordered" placeholder="#services">
                            </div>
                        </div>
                    </div>

                    <div class="form-control bg-gray-50 p-4 rounded-xl border border-dashed border-gray-300">
                        <label class="label font-bold text-gray-700">Ảnh nền Banner (Hero Image)</label>
                        {{ if .Settings.HeroImage }}
                        <div class="relative w-full h-40 rounded-lg overflow-hidden mb-3 group">
                            <img src="/api/files/settings/{{.Settings.Id}}/{{.Settings.HeroImage}}"
                                class="w-full h-full object-cover">
                            <div
                                class="absolute inset-0 bg-black/50 flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity">
                                Ảnh hiện tại
                            </div>
                        </div>
                        {{ end }}
                        <input type="file" name="hero_image" class="file-input file-input-bordered w-full"
                            accept="image/*">
                        <label class="label"><span class="label-text-alt">Nên dùng ảnh ngang, chất lượng cao
                                (1920x1080).</span></label>
                    </div>
                </div>
            </div>

            <div x-show="activeTab === 'payment'" class="space-y-6 animate-fade-in" style="display: none;">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-control">
                        <label class="label font-bold">Ngân hàng (Bin)</label>
                        <input type="text" name="bank_bin" value="{{.Settings.BankBin}}" class="input input-bordered">
                    </div>
                    <div class="form-control">
                        <label class="label font-bold">Số tài khoản</label>
                        <input type="text" name="bank_account" value="{{.Settings.BankAccount}}"
                            class="input input-bordered">
                    </div>
                    <div class="form-control">
                        <label class="label font-bold">Chủ tài khoản</label>
                        <input type="text" name="bank_owner" value="{{.Settings.BankOwner}}"
                            class="input input-bordered">
                    </div>
                </div>
            </div>

            <div x-show="activeTab === 'license'" class="space-y-6 animate-fade-in" style="display: none;">
                <div class="alert"
                    :class="'{{.Settings.ExpiryDate}}' !== '' ? 'alert-success bg-green-50 border-green-200' : 'alert-warning bg-orange-50 border-orange-200'">
                    <i class="fa-solid fa-certificate text-2xl"
                        :class="'{{.Settings.ExpiryDate}}' !== '' ? 'text-green-600' : 'text-orange-600'"></i>
                    <div>
                        <h3 class="font-bold">Trạng thái bản quyền</h3>
                        <div class="text-sm">
                            {{ if .Settings.ExpiryDate }}
                            Thời hạn đến: <strong>{{.Settings.ExpiryDate}}</strong>
                            {{ else }}
                            Chưa kích hoạt hoặc hết hạn
                            {{ end }}
                        </div>
                    </div>
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Mã Kích Hoạt (License Key)</label>
                    <div class="join">
                        <input type="text" name="license_key" value="{{.Settings.LicenseKey}}"
                            class="input input-bordered join-item w-full font-mono text-sm"
                            placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
                        <button type="submit" name="action" value="update_license"
                            class="btn btn-primary join-item">Kích Hoạt</button>
                    </div>
                    <label class="label">
                        <span class="label-text-alt text-gray-500">Nhập mã JWT hợp lệ để gia hạn sử dụng phần
                            mềm.</span>
                    </label>
                </div>
            </div>

            <div x-show="activeTab === 'notifications'" class="space-y-6 animate-fade-in" style="display: none;"
                x-data="{ permission: Notification.permission }">

                <div class="alert" :class="{
                    'alert-success bg-green-50 border-green-200': permission === 'granted',
                    'alert-warning bg-orange-50 border-orange-200': permission === 'default',
                    'alert-error bg-red-50 border-red-200': permission === 'denied'
                }">
                    <i class="fa-solid text-2xl" :class="{
                        'fa-check-circle text-green-600': permission === 'granted',
                        'fa-circle-exclamation text-orange-600': permission === 'default',
                        'fa-ban text-red-600': permission === 'denied'
                    }"></i>
                    <div>
                        <h3 class="font-bold">Trạng thái thông báo: <span
                                x-text="permission === 'granted' ? 'Đã bật' : (permission === 'denied' ? 'Đã chặn' : 'Chưa kích hoạt')"></span>
                        </h3>
                        <div class="text-sm">
                            <span x-show="permission === 'granted'">Bạn sẽ nhận được thông báo khi có đơn hàng
                                mới.</span>
                            <span x-show="permission === 'default'">Bạn chưa cho phép nhận thông báo từ trình
                                duyệt.</span>
                            <span x-show="permission === 'denied'">Bạn đã chặn thông báo. Hãy mở cài đặt trình duyệt để
                                cấp quyền lại.</span>
                        </div>
                    </div>
                    <button type="button" x-show="permission === 'default'" @click="enableNotifications()"
                        class="btn btn-sm btn-primary">Bật ngay</button>
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Test Thông Báo</label>
                    <button type="button" class="btn btn-ghost border-gray-300 gap-2 w-fit"
                        onclick="new Notification('Test', {body: 'Thông báo hoạt động tốt!'})">
                        <i class="fa-solid fa-paper-plane"></i> Gửi thông báo thử
                    </button>
                </div>
            </div>

        </div>

        <div class="bg-gray-50 px-4 py-4 md:px-8 md:py-5 border-t flex justify-end items-center gap-4">
            <span class="text-xs text-gray-400 hidden md:inline" id="saveStatus"></span>
            <button type="submit" class="btn btn-primary w-full md:w-auto px-8 text-white shadow-lg shadow-blue-500/30">
                <i class="fa-solid fa-save mr-2"></i> Lưu Cấu Hình
            </button>
        </div>
    </form>
</div>
{{ end }}