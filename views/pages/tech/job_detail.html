{{ define "content" }}
<div x-data="JobDetailController({
        id: '{{.Job.Id}}',
        lat: {{.Job.GetFloat "lat"}}, 
        long: {{.Job.GetFloat "long"}}, 
        address: {{printf "%q" (or (.Job.GetString "address_details") (.Job.GetString "address"))}}, 
        status: '{{.Job.GetString "job_status"}}' 
    })"
    class="bg-gray-50 min-h-screen pb-32">

    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <a href="/tech/jobs" class="btn btn-sm btn-circle btn-ghost">
                    <i class="fa-solid fa-arrow-left text-lg"></i>
                </a>
                <h1 class="font-bold text-lg text-gray-800">Chi tiết công việc</h1>
            </div>
            <span class="badge font-bold uppercase text-[10px] tracking-wider" :class="{
                'badge-warning': status === 'pending' || status === 'assigned',
                'badge-primary': status === 'moving',
                'badge-secondary': status === 'working',
                'badge-success': status === 'completed',
                'badge-ghost': status === 'cancelled'
            }" x-text="getStatusLabel(status)"></span>
        </div>

        {{template "tech/status_stepper" .}}
    </nav>

    <div class="max-w-lg mx-auto p-4 space-y-4">

        {{template "tech/customer_card" .}}

        <div class="card bg-white shadow-sm border border-gray-100 rounded-2xl">
            <div class="p-5">
                <h3 class="font-bold text-gray-500 text-xs uppercase tracking-wider mb-3">Thông tin yêu cầu</h3>

                <div class="space-y-3">
                    <div class="flex justify-between border-b border-dashed pb-2">
                        <span class="text-gray-600">Dịch vụ</span>
                        <span class="font-bold text-blue-700">{{.Job.GetString "device_type"}} {{.Job.GetString "brand"}}</span>
                    </div>
                    <div class="flex justify-between border-b border-dashed pb-2">
                        <span class="text-gray-600">Thời gian hẹn</span>
                        <span class="font-mono font-medium">{{.Job.GetString "booking_time"}}</span>
                    </div>
                    <div>
                        <span class="text-gray-600 block mb-1">Ghi chú / Sự cố:</span>
                        <div class="bg-yellow-50 text-yellow-800 p-3 rounded-lg text-sm italic border border-yellow-100">
                            "{{.Job.GetString "issue_description"}}"
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {{ if eq (.Job.GetString "job_status") "completed" }}
        <div class="card bg-white shadow-sm border-t-4 border-success">
            <div class="card-body p-5 text-center">
                <i class="fa-solid fa-check-circle text-5xl text-success mb-2"></i>
                <h3 class="font-bold text-lg">Đã Hoàn Thành</h3>
                <p class="text-gray-500">Tổng thu:
                    <span class="font-bold text-primary">
                        {{ if .Invoice }}{{ printf "%.0f" (.Invoice.GetFloat "total_amount") }}{{ else }}0{{ end }}k
                    </span>
                </p>
            </div>
        </div>
        {{ end }}
    </div>

    {{ if ne (.Job.GetString "job_status") "completed" }}
    {{template "tech/job_actions_bar" dict "JobId" .Job.Id}}
    {{ end }}

    {{template "tech/cancel_modal" .}}
</div>

<script src="/assets/js/controllers/job_detail_controller.js?v=7"></script>
{{ end }}