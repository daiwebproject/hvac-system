{{ define "content" }}
<div x-data="JobDetailController({
        id: '{{.Job.Id}}',
        lat: {{.Job.GetFloat " lat"}}, long: {{.Job.GetFloat "long" }}, address: {{printf "%q" (or
    (.Job.GetString "address_details" ) (.Job.GetString "address" ))}}, status: '{{.Job.GetString "job_status"}}' })"
    class="bg-gray-50 min-h-screen pb-32">

    <!-- Navbar -->
    <nav class="bg-white/90 backdrop-blur-md shadow-sm sticky top-0 z-40 border-b border-gray-100/50">
        <div class="px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <a href="/tech/jobs" class="btn btn-sm btn-circle btn-ghost -ml-2 text-gray-600">
                    <i class="fa-solid fa-arrow-left text-lg"></i>
                </a>
                <div>
                    <h1 class="font-bold text-gray-800 leading-tight">Chi tiết công việc</h1>
                    <p class="text-[10px] text-gray-400 font-mono">#{{slice .Job.Id 0 8}}</p>
                </div>
            </div>

            <span class="badge font-bold uppercase text-[10px] tracking-wider py-3 border-none shadow-sm" :class="{
                'bg-yellow-100 text-yellow-700': status === 'pending' || status === 'assigned',
                'bg-blue-100 text-blue-700': status === 'moving',
                'bg-indigo-100 text-indigo-700': status === 'working',
                'bg-green-100 text-green-700': status === 'completed',
                'bg-gray-100 text-gray-500': status === 'cancelled'
            }">
                <i class="fa-solid mr-1" :class="{
                    'fa-bell': status === 'pending' || status === 'assigned',
                    'fa-motorcycle': status === 'moving',
                    'fa-screwdriver-wrench': status === 'working',
                    'fa-check': status === 'completed',
                    'fa-ban': status === 'cancelled'
                }"></i>
                <span x-text="getStatusLabel(status)"></span>
            </span>
        </div>

        {{template "tech/status_stepper" .}}
    </nav>

    <div class="max-w-lg mx-auto p-5 space-y-5">

        {{template "tech/customer_card" .}}

        <!-- Service Info Card -->
        <div class="card bg-white shadow-sm border border-gray-100 rounded-[20px] overflow-hidden">
            <div class="p-5">
                <div class="flex items-center gap-2 mb-4">
                    <div class="w-8 h-8 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-600">
                        <i class="fa-solid fa-circle-info text-sm"></i>
                    </div>
                    <h3 class="font-bold text-gray-900 text-sm uppercase tracking-wider">Thông tin dịch vụ</h3>
                </div>

                <div class="space-y-4">
                    <div class="flex justify-between items-center py-2 border-b border-dashed border-gray-100">
                        <span class="text-gray-500 text-sm">Thiết bị</span>
                        <span class="font-bold text-gray-900">{{.Job.GetString "device_type"}} <span
                                class="text-gray-400">|</span> {{.Job.GetString "brand"}}</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b border-dashed border-gray-100">
                        <span class="text-gray-500 text-sm">Hẹn lúc</span>
                        <div
                            class="flex items-center gap-2 bg-blue-50 px-2 py-1 rounded text-blue-700 font-mono text-sm font-bold">
                            <i class="fa-regular fa-clock text-xs"></i> {{.Job.GetString "booking_time"}}
                        </div>
                    </div>

                    <div class="pt-2">
                        <span class="text-gray-500 text-sm block mb-2">Ghi chú từ khách:</span>
                        <div
                            class="bg-amber-50 text-amber-900 p-4 rounded-xl text-sm border border-amber-100/50 flex gap-3 shadow-sm">
                            <i class="fa-solid fa-quote-left text-amber-300 text-lg"></i>
                            <p class="font-medium italic leading-relaxed">
                                "{{ or (.Job.GetString "issue_description") "Không có mô tả chi tiết" }}"
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {{ if eq (.Job.GetString "job_status") "completed" }}
        <div class="card bg-white shadow-sm border border-green-200 rounded-[20px] overflow-hidden">
            <div class="card-body p-6 text-center bg-gradient-to-b from-green-50/50 to-transparent">
                <div
                    class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-3 shadow-inner">
                    <i class="fa-solid fa-check text-3xl"></i>
                </div>
                <h3 class="font-bold text-xl text-gray-800">Hoàn Thành Xuất Sắc!</h3>
                <div class="divider my-2"></div>
                <p class="text-gray-500 text-sm uppercase tracking-wider font-medium">Tổng thu thực tế</p>
                <p class="font-black text-3xl text-primary mt-1">
                    {{ if .Invoice }}{{ formatMoney (.Invoice.GetFloat "total_amount") }}{{ else }}0{{ end }}đ
                </p>
            </div>
        </div>
        {{ end }}
    </div>

    {{ if ne (.Job.GetString "job_status") "completed" }}
    {{template "tech/job_actions_bar" dict "JobId" .Job.Id}}
    {{ end }}

    {{template "tech/cancel_modal" .}}
</div>

<script src="/assets/js/controllers/job_detail_controller.js?v=7"></script>
{{ end }}