{{ define "content" }}
<script>
    window.TECH_INIT = {
        userActive: {{ if .Auth.GetBool "active" }}true{{ else }}false{{ end }}
        };
    console.log('✅ TECH_INIT loaded:', window.TECH_INIT);
</script>
<div x-data="techDashboard()" x-init="initDashboard()" class="min-h-screen bg-gray-50">

    <div
        class="bg-gradient-to-br from-blue-700 to-blue-900 rounded-b-[2.5rem] shadow-xl text-white relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 pointer-events-none">
            <i class="fas fa-tools text-9xl -mr-10 -mt-10 transform rotate-12"></i>
        </div>

        <div class="p-6 pt-10 pb-12">
            <div class="flex justify-between items-start mb-8">
                <div>
                    <p class="text-blue-200 text-sm font-medium mb-1 flex items-center gap-2">
                        <i class="fa-solid fa-hard-hat"></i> Xin chào,
                    </p>
                    <h2 class="text-3xl font-bold tracking-tight mb-3 text-white drop-shadow-md">{{.Auth.Name}}</h2>

                    <!-- Premium Status Toggle -->
                    <div
                        class="inline-flex bg-white/10 backdrop-blur-md rounded-full p-1 pl-1.5 pr-3 items-center border border-white/20 shadow-inner">
                        <label class="cursor-pointer flex items-center gap-3 relative select-none">
                            <input type="checkbox" class="sr-only" :checked="userActive"
                                hx-post="/api/tech/status/toggle" hx-swap="none"
                                @htmx:after-request="if($event.detail.successful) { userActive = $event.detail.xhr.response ? JSON.parse($event.detail.xhr.response).active : !userActive }" />

                            <div class="w-10 h-6 rounded-full shadow-inner transition-colors duration-300 relative"
                                :class="userActive ? 'bg-green-500' : 'bg-gray-600'">
                                <div class="absolute w-4 h-4 bg-white rounded-full shadow transition-transform duration-300 top-1 left-1"
                                    :class="userActive ? 'translate-x-4' : 'translate-x-0'"></div>
                            </div>

                            <span class="text-xs font-bold transition-colors duration-300 uppercase tracking-wider"
                                :class="userActive ? 'text-green-300' : 'text-gray-400'"
                                x-text="userActive ? 'Đang trực' : 'Nghỉ làm'"></span>
                        </label>
                    </div>
                </div>

                <div
                    class="relative p-3 bg-white/10 rounded-full hover:bg-white/20 transition cursor-pointer backdrop-blur-md border border-white/10">
                    <i class="fas fa-bell text-xl"></i>
                    <span
                        class="absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-blue-900 animate-ping"></span>
                    <span
                        class="absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-blue-900"></span>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white/10 backdrop-blur-md p-4 rounded-2xl border border-white/10">
                    <p class="text-xs text-blue-200 mb-1">Hoàn thành hôm nay</p>
                    <p class="text-2xl font-bold">{{.CompletedTodayCount}} <span class="text-sm font-normal">ca</span>
                    </p>
                </div>
                <div class="bg-white/10 backdrop-blur-md p-4 rounded-2xl border border-white/10">
                    <p class="text-xs text-blue-200 mb-1">Thu nhập ước tính</p>
                    <p class="text-2xl font-bold text-yellow-300">
                        {{if .TodayEarnings}}{{.TodayEarnings | printf "%.0f"}}k{{else}}0{{end}}
                    </p>
                </div>
            </div>
        </div>

        <div class="bg-black/20 px-6 py-2 text-xs flex items-center gap-2 text-blue-100">
            <i class="fas fa-lightbulb text-yellow-300"></i>
            <span x-text="getTodayTip()" class="truncate"></span>
        </div>
    </div>

    <div class="px-4 -mt-6 relative z-10" x-data="{ activeTab: 'new' }">
        <div class="bg-white rounded-xl shadow-lg p-1.5 flex justify-between">
            <button class="flex-1 py-2.5 rounded-lg text-sm font-medium transition-all flex flex-col items-center gap-1"
                :class="activeTab === 'new' ? 'bg-blue-50 text-blue-700 shadow-sm' : 'text-gray-500 hover:bg-gray-50'"
                @click="activeTab = 'new'" hx-get="/api/tech/jobs/list?status=new" hx-target="#job-list-container"
                hx-swap="innerHTML">
                <i class="fas fa-bell"></i>
                <span class="text-xs">Mới giao</span>
            </button>

            <button class="flex-1 py-2.5 rounded-lg text-sm font-medium transition-all flex flex-col items-center gap-1"
                :class="activeTab === 'active' ? 'bg-amber-50 text-amber-700 shadow-sm' : 'text-gray-500 hover:bg-gray-50'"
                @click="activeTab = 'active'" hx-get="/api/tech/jobs/list?status=active" hx-target="#job-list-container"
                hx-swap="innerHTML">
                <i class="fas fa-person-digging"></i>
                <span class="text-xs">Đang làm</span>
            </button>

            <button class="flex-1 py-2.5 rounded-lg text-sm font-medium transition-all flex flex-col items-center gap-1"
                :class="activeTab === 'completed' ? 'bg-green-50 text-green-700 shadow-sm' : 'text-gray-500 hover:bg-gray-50'"
                @click="activeTab = 'completed'" hx-get="/api/tech/jobs/list?status=completed"
                hx-target="#job-list-container" hx-swap="innerHTML">
                <i class="fas fa-check-circle"></i>
                <span class="text-xs">Lịch sử</span>
            </button>
        </div>
    </div>

    <div class="px-4 mt-6 pb-24">
        <div class="htmx-indicator flex justify-center py-4">
            <span class="loading loading-dots loading-lg text-blue-600"></span>
        </div>

        <div id="job-list-container" class="space-y-4" hx-get="/api/tech/jobs/list?status=new"
            hx-trigger="load, statusUpdated from:body" hx-swap="innerHTML">

            <div class="animate-pulse space-y-4">
                <div class="h-32 bg-gray-200 rounded-xl"></div>
                <div class="h-32 bg-gray-200 rounded-xl"></div>
            </div>
        </div>
    </div>
</div>
{{ end }}