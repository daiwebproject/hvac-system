{{define "tech/cancel_modal"}}
<!-- Cancel Modal -->
<div x-show="showCancelModal" x-cloak class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"
    @click.self="showCancelModal = false">
    <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl" @click.stop>
        <h3 class="text-xl font-bold mb-4 text-gray-800">
            <i class="fa-solid fa-triangle-exclamation text-orange-500"></i> Báo cáo sự cố / Hủy
        </h3>
        <p class="text-sm text-gray-600 mb-4">Vui lòng chọn tình huống:</p>

        <select x-model="cancelReason" class="select select-bordered w-full mb-4">
            <option value="">-- Chọn lý do --</option>
            <option value="customer_not_home">Khách không có nhà (Cần ảnh)</option>
            <option value="reschedule">Khách hẹn lại lịch</option>
            <option value="customer_cancelled">Khách hủy yêu cầu</option>
            <option value="cannot_fix">Không thể sửa được</option>
            <option value="missing_parts">Thiếu linh kiện</option>
            <option value="other">Lý do khác</option>
        </select>

        <!-- Photo Evidence Input -->
        <div x-show="cancelReason === 'customer_not_home'" class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Chụp ảnh cửa nhà khách (*)</label>
            <input type="file" x-ref="evidenceInput" accept="image/*" capture="environment"
                class="file-input file-input-bordered w-full" />
        </div>

        <!-- New Time Input -->
        <div x-show="cancelReason === 'reschedule'" class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Chọn thời gian mới (*)</label>
            <input type="datetime-local" x-model="newTime" class="input input-bordered w-full" />
        </div>

        <textarea x-show="cancelReason === 'other' || cancelReason === 'cannot_fix' || cancelReason === 'missing_parts'"
            x-model="cancelNote" class="textarea textarea-bordered w-full mb-4"
            placeholder="Nhập ghi chú cụ thể..."></textarea>

        <div class="flex gap-3 justify-end">
            <button @click="showCancelModal = false" class="btn btn-ghost">Đóng</button>
            <button @click="cancelJob()" :disabled="!cancelReason || loading" class="btn btn-error">
                <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                <span x-text="cancelReason === 'reschedule' ? 'Đổi lịch' : 'Xác nhận hủy'"></span>
            </button>
        </div>
    </div>
</div>
{{end}}