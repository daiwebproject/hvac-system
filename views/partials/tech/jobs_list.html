{{define "tech_jobs_list"}}
<div id="job-list-container" class="space-y-4 pb-24">
    {{range .Jobs}}
    {{ $status := .GetString "job_status" }}

    <!-- Status Config -->
    {{ $borderClass := "border-l-4 border-gray-300" }}
    {{ $statusBadgeClass := "badge-ghost" }}
    {{ $statusLabel := "Không xác định" }}
    {{ $actionBtnClass := "btn-outline" }}
    {{ $actionLabel := "Chi tiết" }}

    {{ if eq $status "assigned" }}
    {{ $borderClass = "border-l-4 border-blue-500" }}
    {{ $statusBadgeClass = "bg-blue-50 text-blue-700 border-blue-100" }}
    {{ $statusLabel = "Mới" }}
    {{ $actionBtnClass = "btn-primary text-white shadow-blue-200" }}
    {{ $actionLabel = "Nhận Việc Ngay" }}
    {{ else if eq $status "moving" }}
    {{ $borderClass = "border-l-4 border-indigo-500" }}
    {{ $statusBadgeClass = "bg-indigo-50 text-indigo-700 border-indigo-100" }}
    {{ $statusLabel = "Đang Di Chuyển" }}
    {{ $actionBtnClass = "btn-info text-white" }}
    {{ $actionLabel = "Đã Đến Nơi" }}
    {{ else if eq $status "arrived" }}
    {{ $borderClass = "border-l-4 border-purple-500" }}
    {{ $statusBadgeClass = "bg-purple-50 text-purple-700 border-purple-100" }}
    {{ $statusLabel = "Đã Đến" }}
    {{ $actionBtnClass = "btn-warning text-white" }}
    {{ $actionLabel = "Bắt Đầu Làm" }}
    {{ else if eq $status "working" }}
    {{ $borderClass = "border-l-4 border-orange-500" }}
    {{ $statusBadgeClass = "bg-orange-50 text-orange-700 border-orange-100" }}
    {{ $statusLabel = "Đang Sửa" }}
    {{ $actionBtnClass = "btn-success text-white" }}
    {{ $actionLabel = "Hoàn Thành" }}
    {{ else if eq $status "completed" }}
    {{ $borderClass = "border-l-4 border-green-500" }}
    {{ $statusBadgeClass = "bg-green-50 text-green-700 border-green-100" }}
    {{ $statusLabel = "Hoàn Thành" }}
    {{ end }}

    <a href="/tech/job/{{.Id}}" class="block group active:scale-[0.98] transition-transform duration-200"
        data-job-id="{{.Id}}">
        <div
            class="card bg-white shadow-sm border border-gray-100 rounded-xl overflow-hidden hover:shadow-md transition-shadow {{ $borderClass }}">
            <div class="card-body p-4">

                <!-- Header -->
                <div class="flex justify-between items-start mb-3">
                    <div class="flex flex-col">
                        <span class="font-bold text-gray-800 text-lg flex items-center gap-2">
                            {{.DisplayTime}}
                        </span>
                        {{ if eq $status "assigned" }}
                        <span class="text-xs text-red-500 font-medium animate-pulse">Cần xử lý gấp</span>
                        {{ end }}
                    </div>
                    <span class="badge {{ $statusBadgeClass }} font-bold border rounded-lg px-3 py-3">
                        {{ $statusLabel }}
                    </span>
                </div>

                <!-- Customer -->
                <div class="flex items-center gap-3 mb-2">
                    <div class="avatar placeholder shrink-0">
                        <div
                            class="bg-gray-100 text-gray-500 rounded-xl w-10 h-10 shadow-inner flex items-center justify-center">
                            <span class="text-lg font-bold">
                                {{ if .GetString "customer_name" }}
                                {{ slice (.GetString "customer_name") 0 1 }}
                                {{ else }}?{{ end }}
                            </span>
                        </div>
                    </div>
                    <div class="min-w-0">
                        <h3 class="font-bold text-gray-900 truncate leading-tight">{{.GetString "customer_name"}}</h3>
                        <p class="text-xs text-gray-500 truncate">{{.GetString "device_type"}}</p>
                    </div>
                </div>

                <!-- Address -->
                <div class="flex items-start gap-2 text-sm text-gray-600 mb-4 pl-1">
                    <i class="fa-solid fa-location-dot mt-1 text-gray-400 shrink-0"></i>
                    <span class="line-clamp-2 leading-relaxed">{{.GetString "address"}}</span>
                </div>

                <!-- Footer / Action -->
                {{ if ne $status "completed" }}
                <button class="btn btn-sm w-full rounded-lg font-bold border-none shadow-sm {{ $actionBtnClass }}">
                    {{ $actionLabel }} <i class="fa-solid fa-arrow-right ml-1"></i>
                </button>
                {{ else }}
                <div class="flex justify-between items-center pt-3 border-t border-gray-50">
                    <span class="text-xs text-gray-400">Cập nhật: {{.GetString "updated" }}</span>
                    <span class="font-bold text-green-600">
                        {{ if .GetFloat "estimated_cost" }}
                        {{ formatMoney (.GetFloat "estimated_cost") }}đ
                        {{ else }}
                        -
                        {{ end }}
                    </span>
                </div>
                {{ end }}

            </div>
        </div>
    </a>

    {{else}}
    <!-- Empty State -->
    <div class="flex flex-col items-center justify-center py-12 text-center opacity-80">
        <div class="w-40 h-40 mb-4">
            <img src="/assets/images/technical-empty-state.png" class="w-full h-full object-contain" alt="No jobs">
        </div>
        <h3 class="font-bold text-gray-600 text-lg">Chưa có công việc nào</h3>
        <p class="text-gray-400 text-sm mt-2 max-w-[200px] mx-auto">
            Hiện tại bạn chưa có đơn hàng nào cần xử lý.
        </p>
    </div>
    {{end}}
</div>
{{end}}