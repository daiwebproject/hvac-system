{{ define "admin_navbar" }}
<div class="sticky top-0 z-50 w-full font-sans">
    <nav class="navbar bg-white/95 backdrop-blur-md shadow-sm border-b border-gray-100 relative z-50">
        <div class="container mx-auto px-2 lg:px-4">

            <!-- Mobile Menu Toggle -->
            <div class="flex-none lg:hidden">
                <button id="mobile-menu-btn" class="btn btn-ghost btn-circle text-gray-600">
                    <i class="fa-solid fa-bars text-xl" id="mobile-menu-icon"></i>
                </button>
            </div>

            <!-- Logo/Brand -->
            <div class="flex-1 text-center lg:text-left flex items-center justify-center lg:justify-start">
                <a href="/admin" class="btn btn-ghost normal-case text-xl px-2 hover:bg-transparent gap-2">
                    <div
                        class="w-9 h-9 rounded-lg bg-gradient-to-br from-blue-600 to-blue-400 flex items-center justify-center text-white shadow-lg shadow-blue-500/30">
                        <i class="fa-solid fa-snowflake"></i>
                    </div>
                    <div class="flex flex-col items-start leading-tight">
                        <span class="font-bold text-gray-800 text-lg">
                            {{ if .Settings.CompanyName }}{{ .Settings.CompanyName }}{{ else }}HVAC Admin{{ end }}
                        </span>
                        <span
                            class="text-[10px] text-gray-400 font-normal uppercase tracking-wider hidden sm:inline-block">Management
                            System</span>
                    </div>
                </a>
            </div>

            <!-- Desktop Menu -->
            <div class="flex-none hidden lg:block">
                <ul class="menu menu-horizontal px-1 gap-1 text-gray-600 font-medium text-sm">
                    <li>
                        <a href="/admin" hx-boost="true" hx-target="#main-content"
                            class="hover:text-blue-600 hover:bg-blue-50 focus:text-blue-600">
                            <i class="fa-solid fa-chart-pie"></i> Dashboard
                        </a>
                    </li>

                    <li class="dropdown dropdown-hover">
                        <summary tabindex="0" class="hover:text-blue-600 hover:bg-blue-50">
                            <i class="fa-solid fa-briefcase"></i> Nghiệp vụ
                        </summary>
                        <ul tabindex="0"
                            class="dropdown-content z-[1] menu p-2 shadow-xl bg-white rounded-box w-52 border border-gray-100 mt-0">
                            <li><a href="/admin/categories" hx-boost="true" hx-target="#main-content"><i
                                        class="fa-solid fa-list-check w-5 text-purple-500"></i> Danh mục</a></li>
                            <li><a href="/admin/services" hx-boost="true" hx-target="#main-content"><i
                                        class="fa-solid fa-screwdriver-wrench w-5 text-blue-500"></i> Dịch vụ</a></li>
                            <li><a href="/admin/techs" hx-boost="true" hx-target="#main-content"><i
                                        class="fa-solid fa-users-gear w-5 text-indigo-500"></i> Kỹ thuật viên</a></li>
                        </ul>
                    </li>

                    <li class="dropdown dropdown-hover">
                        <summary tabindex="0" class="hover:text-blue-600 hover:bg-blue-50">
                            <i class="fa-solid fa-toolbox"></i> Công cụ
                        </summary>
                        <ul tabindex="0"
                            class="dropdown-content z-[1] menu p-2 shadow-xl bg-white rounded-box w-52 border border-gray-100 mt-0">
                            <li><a href="/admin/tools/slots" hx-boost="true" hx-target="#main-content"><i
                                        class="fa-solid fa-calendar-days w-5 text-green-500"></i> Lịch hẹn</a></li>
                            <li><a href="/admin/tools/inventory" hx-boost="true" hx-target="#main-content"><i
                                        class="fa-solid fa-warehouse w-5 text-orange-500"></i> Kho vật tư</a></li>
                            <li><a href="/admin/tools/tech-stock" hx-boost="true" hx-target="#main-content"><i
                                        class="fa-solid fa-truck-ramp-box w-5 text-blue-500"></i> Kho trên xe</a></li>
                        </ul>
                    </li>

                    <li>
                        <a href="/admin/settings" hx-boost="true" hx-target="#main-content"
                            class="hover:text-blue-600 hover:bg-blue-50">
                            <i class="fa-solid fa-gear"></i> Cài đặt
                        </a>
                    </li>
                </ul>
            </div>

            <!-- iOS Notification Button (Desktop) -->
            <div id="btn-enable-notify" class="hidden flex-none items-center mr-2">
                <button onclick="requestAdminPermission()"
                    class="btn btn-sm btn-error text-white animate-pulse shadow-lg border-none gap-2">
                    <i class="fa-solid fa-bell"></i>
                    <span class="hidden sm:inline">Bật thông báo</span>
                </button>
            </div>

            <!-- User Dropdown (Desktop) -->
            <div class="flex-none hidden lg:block ml-3 pl-3 border-l border-gray-200">
                <div class="dropdown dropdown-end">
                    <label tabindex="0" class="btn btn-ghost btn-circle avatar placeholder">
                        <div
                            class="bg-gray-100 text-gray-600 rounded-full w-10 h-10 border border-gray-200 hover:border-blue-400 transition-colors">
                            <span class="text-sm font-bold">AD</span>
                        </div>
                    </label>
                    <ul tabindex="0"
                        class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow-xl bg-white rounded-box w-52 border border-gray-100">
                        <li class="menu-title text-gray-400 text-xs px-2">Tài khoản Quản trị</li>
                        <li class="disabled"><a class="flex justify-between">Role <span
                                    class="badge badge-xs badge-primary">Super Admin</span></a></li>
                        <div class="divider my-1"></div>
                        <li><a href="/admin/logout" class="text-red-600 hover:bg-red-50"><i
                                    class="fa-solid fa-arrow-right-from-bracket"></i> Đăng xuất</a></li>
                    </ul>
                </div>
            </div>

            <!-- Logout (Mobile) -->
            <div class="flex-none lg:hidden">
                <a href="/admin/logout" class="btn btn-ghost btn-circle text-gray-400 hover:text-red-500">
                    <i class="fa-solid fa-power-off text-lg"></i>
                </a>
            </div>

        </div>
    </nav>

    <!-- Mobile Menu Container (Hidden by default) -->
    <div id="mobile-menu"
        class="absolute top-full left-0 w-full bg-white shadow-xl border-t border-gray-100 hidden transform origin-top transition-all duration-200 z-40 max-h-[calc(100vh-64px)] overflow-y-auto">

        <div class="p-4 space-y-4">
            <!-- Dashboard Link -->
            <a href="/admin" hx-boost="true" hx-target="#main-content"
                class="mobile-nav-link flex items-center gap-3 p-3 rounded-xl bg-blue-50 text-blue-700 font-bold">
                <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-blue-600 shadow-sm">
                    <i class="fa-solid fa-chart-line"></i>
                </div>
                <span>Dashboard</span>
            </a>

            <!-- History Link -->
            <a href="/admin/history" hx-boost="true" hx-target="#main-content"
                class="mobile-nav-link flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 text-gray-600">
                <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-blue-600 shadow-sm">
                    <i class="fa-solid fa-clock-rotate-left"></i>
                </div>
                <span>Lịch sử</span>
            </a>

            <!-- Section: Nghiep vu -->
            <div>
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 px-1">Nghiệp vụ</h3>
                <div class="space-y-1">
                    <a href="/admin/categories" hx-boost="true" hx-target="#main-content"
                        class="mobile-nav-link flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 text-gray-600">
                        <i class="fa-solid fa-list-check w-6 text-center text-purple-500"></i> Danh mục
                    </a>
                    <a href="/admin/services" hx-boost="true" hx-target="#main-content"
                        class="mobile-nav-link flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 text-gray-600">
                        <i class="fa-solid fa-screwdriver-wrench w-6 text-center text-blue-500"></i> Dịch vụ
                    </a>
                    <a href="/admin/techs" hx-boost="true" hx-target="#main-content"
                        class="mobile-nav-link flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 text-gray-600">
                        <i class="fa-solid fa-users-gear w-6 text-center text-indigo-500"></i> Kỹ thuật viên
                    </a>
                </div>
            </div>

            <!-- Section: Cong cu -->
            <div>
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 px-1">Công cụ</h3>
                <div class="space-y-1">
                    <a href="/admin/tools/slots" hx-boost="true" hx-target="#main-content"
                        class="mobile-nav-link flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 text-gray-600">
                        <i class="fa-solid fa-calendar-check w-6 text-center text-green-500"></i> Lịch hẹn
                    </a>
                    <a href="/admin/tools/inventory" hx-boost="true" hx-target="#main-content"
                        class="mobile-nav-link flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 text-gray-600">
                        <i class="fa-solid fa-boxes-stacked w-6 text-center text-orange-500"></i> Kho vật tư
                    </a>
                    <a href="/admin/tools/tech-stock" hx-boost="true" hx-target="#main-content"
                        class="mobile-nav-link flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 text-gray-600">
                        <i class="fa-solid fa-truck-ramp-box w-6 text-center text-blue-500"></i> Kho trên xe
                    </a>
                </div>
            </div>

            <!-- Section: System -->
            <div>
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 px-1">Hệ thống</h3>
                <div class="space-y-1">
                    <a href="/admin/settings" hx-boost="true" hx-target="#main-content"
                        class="mobile-nav-link flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 text-gray-600">
                        <i class="fa-solid fa-sliders w-6 text-center text-gray-500"></i> Cài đặt
                    </a>
                    <a href="/admin/logout"
                        class="flex items-center gap-3 p-3 rounded-xl hover:bg-red-50 text-red-600 mt-2 border border-red-100">
                        <i class="fa-solid fa-power-off w-6 text-center"></i> Đăng xuất
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    (function () {
        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');
        const icon = document.getElementById('mobile-menu-icon');
        const links = document.querySelectorAll('.mobile-nav-link');

        if (!btn || !menu) return;

        function toggleMenu() {
            const isHidden = menu.classList.contains('hidden');
            if (isHidden) {
                menu.classList.remove('hidden');
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-xmark');
            } else {
                menu.classList.add('hidden');
                icon.classList.remove('fa-xmark');
                icon.classList.add('fa-bars');
            }
        }

        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleMenu();
        });

        links.forEach(link => {
            link.addEventListener('click', () => {
                menu.classList.add('hidden');
                icon.classList.remove('fa-xmark');
                icon.classList.add('fa-bars');
            });
        });

        document.addEventListener('click', (e) => {
            if (!menu.classList.contains('hidden') && !menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add('hidden');
                icon.classList.remove('fa-xmark');
                icon.classList.add('fa-bars');
            }
        });
    })();
</script>
{{ end }}